<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç«ç¾½éº»å°†æ¶ˆæ¶ˆä¹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ€„</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a5f23 0%, #0d3b1e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
        }
        
        h1 {
            font-size: 1.8rem;
            color: #ffde59;
            text-shadow: 2px 2px 0 #c53030, 4px 4px 0 rgba(0, 0, 0, 0.2);
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            color: #b8ffc1;
            margin-bottom: 15px;
            padding: 0 10px;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 500px;
            background: rgba(10, 60, 30, 0.9);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            border: 4px solid #ffde59;
            position: relative;
            overflow: hidden;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 15px;
            background: rgba(30, 100, 50, 0.8);
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #ffde59;
            flex-wrap: wrap;
        }
        
        .info-box {
            text-align: center;
            flex: 1;
            margin: 3px;
            min-width: 70px;
        }
        
        .info-label {
            font-size: 0.75rem;
            color: #b8ffc1;
            margin-bottom: 2px;
        }
        
        .info-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ffde59;
            text-shadow: 1px 1px 0 #c53030;
        }
        
        .game-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            width: 100%;
            justify-content: center;
        }
        
        .btn {
            padding: 8px 12px;
            font-size: 0.9rem;
            font-weight: bold;
            color: #0d3b1e;
            background: #ffde59;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 3px 0 #c53030;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex: 1;
            max-width: 110px;
            touch-action: manipulation;
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #c53030;
        }
        
        .btn-restart {
            background: #ff7b7b;
        }
        
        .btn-scoreboard {
            background: #6a5acd;
        }
        
        .main-board {
            position: relative;
            width: 100%;
            height: 320px;
            background: rgba(20, 80, 40, 0.7);
            border-radius: 12px;
            border: 3px solid #ffde59;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .tile-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .tile {
            position: absolute;
            width: 60px;
            height: 75px;
            background: linear-gradient(145deg, #fff8e1 0%, #ffe082 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #d7b354;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            transform-origin: center;
            padding: 0;
        }
        
        .tile:hover, .tile:active {
            transform: scale(1.05);
        }
        
        .tile.selected {
            border-color: #ff3e3e;
            box-shadow: 0 0 15px #ff3e3e;
            animation: pulse 0.8s infinite alternate;
            z-index: 1000 !important;
        }
        
        @keyframes pulse {
            from { box-shadow: 0 0 10px #ff3e3e; }
            to { box-shadow: 0 0 20px #ff3e3e; }
        }
        
        .tile.removing {
            animation: removeTile 0.5s forwards;
        }
        
        @keyframes removeTile {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        .tile.hint {
            box-shadow: 0 0 15px #00ff00;
            border-color: #00ff00;
        }
        
        .tile-symbol {
            font-size: 2.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
        
        .tile-symbol.honor {
            color: #0d47a1;
        }
        
        .tile-symbol.bamboo {
            color: #1b5e20;
        }
        
        .tile-symbol.circle {
            color: #b71c1c;
        }
        
        .tile-symbol.character {
            color: #b71c1c;
        }
        
        .tile-symbol.wind {
            color: #4a148c;
        }
        
        .tile-symbol.dragon {
            color: #0d47a1;
        }
        
        .tile-symbol.flower {
            color: #e91e63;
        }
        
        .tile-symbol.season {
            color: #009688;
        }
        
        .placeholder-area {
            width: 100%;
            min-height: 100px;
            background: rgba(20, 80, 40, 0.6);
            border-radius: 10px;
            border: 2px dashed #ffde59;
            margin-bottom: 15px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .placeholder-title {
            color: #ffde59;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .placeholder-slots {
            display: flex;
            justify-content: center;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .slot {
            width: 55px;
            height: 70px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border: 2px dashed rgba(255, 222, 89, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 222, 89, 0.5);
            font-size: 0.8rem;
        }
        
        .slot.occupied {
            border: 2px solid #ffde59;
            background: rgba(255, 222, 89, 0.1);
        }
        
        .selected-tiles-container {
            width: 100%;
            min-height: 85px;
            background: rgba(20, 80, 40, 0.6);
            border-radius: 10px;
            border: 2px dashed #ffde59;
            margin-bottom: 15px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .selected-title {
            color: #ffde59;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .selected-tiles {
            display: flex;
            justify-content: center;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .selected-tile {
            width: 50px;
            height: 65px;
            background: linear-gradient(145deg, #fff8e1 0%, #ffe082 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            border: 2px solid #ff3e3e;
        }
        
        .empty-selection {
            color: #b8ffc1;
            font-size: 0.9rem;
            text-align: center;
            padding: 10px;
        }
        
        .instructions {
            width: 100%;
            max-width: 500px;
            margin-top: 15px;
            background: rgba(30, 100, 50, 0.8);
            padding: 12px;
            border-radius: 10px;
            border: 3px solid #ffde59;
        }
        
        .instructions h3 {
            color: #ffde59;
            font-size: 1.2rem;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .instructions ol {
            padding-left: 18px;
            line-height: 1.5;
        }
        
        .instructions li {
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        
        .instructions strong {
            color: #ffde59;
        }
        
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
            padding: 20px;
        }
        
        .game-over.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .game-over-content {
            background: linear-gradient(135deg, #1a5f23 0%, #0d3b1e 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            width: 100%;
            max-width: 350px;
            border: 4px solid #ffde59;
            transform: scale(0.8);
            transition: transform 0.5s;
        }
        
        .game-over.active .game-over-content {
            transform: scale(1);
        }
        
        .game-over h2 {
            font-size: 1.8rem;
            color: #ffde59;
            margin-bottom: 12px;
            text-shadow: 2px 2px 0 #c53030;
        }
        
        .game-over p {
            font-size: 1rem;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .final-score {
            font-size: 1.8rem;
            color: #ffde59;
            font-weight: bold;
            margin: 12px 0;
            text-shadow: 2px 2px 0 #c53030;
        }
        
        .game-over-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .game-over-buttons .btn {
            max-width: 130px;
        }
        
        .scoreboard-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
            padding: 20px;
        }
        
        .scoreboard-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .scoreboard-content {
            background: linear-gradient(135deg, #1a5f23 0%, #0d3b1e 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            width: 100%;
            max-width: 350px;
            border: 4px solid #ffde59;
            transform: scale(0.8);
            transition: transform 0.5s;
        }
        
        .scoreboard-modal.active .scoreboard-content {
            transform: scale(1);
        }
        
        .scoreboard-content h2 {
            font-size: 1.8rem;
            color: #ffde59;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 #c53030;
        }
        
        .scoreboard-item {
            background: rgba(30, 100, 50, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #ffde59;
        }
        
        .scoreboard-label {
            font-size: 0.9rem;
            color: #b8ffc1;
            margin-bottom: 5px;
        }
        
        .scoreboard-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffde59;
            text-shadow: 1px 1px 0 #c53030;
        }
        
        .level-indicator {
            display: inline-block;
            background: #ffde59;
            color: #0d3b1e;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
            margin-left: 5px;
            font-size: 0.7rem;
        }
        
        .level-indicator-large {
            display: inline-block;
            background: #ffde59;
            color: #0d3b1e;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        .completion-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .completion-animation.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .completion-content {
            background: linear-gradient(135deg, #1a5f23 0%, #0d3b1e 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 100%;
            max-width: 400px;
            border: 5px solid #ffde59;
            transform: scale(0.8);
            transition: transform 0.5s;
            position: relative;
            overflow: hidden;
        }
        
        .completion-animation.active .completion-content {
            transform: scale(1);
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px #ffde59; }
            to { box-shadow: 0 0 40px #ffde59, 0 0 60px #ff7b7b; }
        }
        
        .completion-title {
            font-size: 2.5rem;
            color: #ffde59;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0 #c53030;
            animation: bounce 1s infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }
        
        .completion-message {
            font-size: 1.2rem;
            color: #fff;
            margin-bottom: 20px;
        }
        
        .completion-score {
            font-size: 2.5rem;
            color: #ffde59;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 0 #c53030;
            animation: pulse 1.5s infinite alternate;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 20px;
            background: #ffde59;
            top: -20px;
            animation: confetti-fall 3s linear forwards;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .footer {
            margin-top: 15px;
            text-align: center;
            color: #b8ffc1;
            font-size: 0.75rem;
            padding-bottom: 10px;
            width: 100%;
        }
        
        .company-logo {
            font-weight: bold;
            color: #ffde59;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .clickable-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 10px;
            height: 10px;
            background-color: #00ff00;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media (orientation: landscape) and (max-height: 600px) {
            .game-container {
                flex-direction: row;
                max-width: 95%;
                padding: 10px;
            }
            
            .game-left-panel {
                flex: 1;
                display: flex;
                flex-direction: column;
                padding-right: 10px;
            }
            
            .main-board {
                flex: 1;
                height: 250px;
                margin-bottom: 0;
            }
            
            .placeholder-area {
                min-height: 70px;
                margin-bottom: 10px;
            }
            
            .selected-tiles-container {
                min-height: 70px;
                margin-bottom: 10px;
            }
            
            .game-controls {
                margin-bottom: 10px;
            }
            
            .tile {
                width: 50px;
                height: 65px;
            }
            
            .tile-symbol {
                font-size: 2.2rem;
            }
            
            .slot {
                width: 45px;
                height: 60px;
            }
        }
        
        /* å°å±å¹•æ‰‹æœºä¼˜åŒ– */
        @media (max-width: 360px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .main-board {
                height: 280px;
            }
            
            .tile {
                width: 50px;
                height: 65px;
            }
            
            .tile-symbol {
                font-size: 2.2rem;
            }
            
            .btn {
                padding: 7px 10px;
                font-size: 0.8rem;
                max-width: 95px;
            }
            
            .slot {
                width: 45px;
                height: 60px;
            }
            
            .selected-tile {
                width: 40px;
                height: 55px;
            }
        }
        
        .auto-match-notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #ffde59;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 1000;
            animation: fadeInOut 1.5s ease-in-out;
            text-align: center;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .warning {
            color: #ff7b7b;
            font-weight: bold;
            animation: warningPulse 1s infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .level-up-notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #ffde59;
            padding: 15px 30px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 1000;
            animation: fadeInOut 2s ease-in-out;
            text-align: center;
            font-size: 1.5rem;
            border: 2px solid #ffde59;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-dragon"></i> ç«ç¾½éº»å°†æ¶ˆæ¶ˆä¹ <i class="fas fa-dragon"></i></h1>
        <p class="subtitle">ä¸è§„åˆ™æ•£è½ç‰ˆ - æ‰€æœ‰ç‰Œä¸è§„åˆ™æ•£è½ï¼Œæœ‰éœ²å‡ºéƒ¨åˆ†å³å¯ç‚¹å‡»æ‹¿å–</p>
    </div>
    
    <div class="game-container">
        <div class="game-info">
            <div class="info-box">
                <div class="info-label">åˆ†æ•°</div>
                <div class="info-value" id="score">0</div>
            </div>
            <div class="info-box">
                <div class="info-label">å‰©ä½™ç‰Œæ•°</div>
                <div class="info-value" id="remaining">9</div>
            </div>
            <div class="info-box">
                <div class="info-label">å…³å¡</div>
                <div class="info-value" id="level">1/10</div>
            </div>
            <div class="info-box">
                <div class="info-label">æ‘†æ”¾æ¡†</div>
                <div class="info-value" id="slots-used">0/8</div>
            </div>
        </div>
        
        <div class="game-controls">
            <button class="btn" id="hint-btn">
                <i class="fas fa-lightbulb"></i> æç¤º
            </button>
            <button class="btn" id="shuffle-btn">
                <i class="fas fa-random"></i> é‡æ’
            </button>
            <button class="btn btn-restart" id="restart-btn">
                <i class="fas fa-redo"></i> é‡ç©
            </button>
            <button class="btn btn-scoreboard" id="scoreboard-btn">
                <i class="fas fa-trophy"></i> ç§¯åˆ†æ¦œ
            </button>
        </div>
        
        <div class="main-board" id="main-board">
            <div class="tile-container" id="tile-container">
                <!-- éº»å°†ç‰Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="placeholder-area">
            <div class="placeholder-title">æ‘†æ”¾æ¡†ï¼ˆæœ€å¤š8å¼ ç‰Œï¼‰<span class="warning">æ”¾ç½®8å¼ ç‰Œå°†å¯¼è‡´å¤±è´¥ï¼</span></div>
            <div class="placeholder-slots" id="placeholder-slots">
                <!-- æ‘†æ”¾æ¡†å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="selected-tiles-container">
            <div class="selected-title">è‡ªåŠ¨æ¶ˆé™¤åŒºåŸŸ</div>
            <div class="selected-tiles" id="selected-tiles">
                <div class="empty-selection">å½“æ‘†æ”¾æ¡†ä¸­æœ‰3å¼ ç›¸åŒç‰Œæ—¶ä¼šè‡ªåŠ¨æ¶ˆé™¤</div>
            </div>
        </div>
    </div>
    
    <div class="instructions">
        <h3><i class="fas fa-info-circle"></i> æ¸¸æˆè§„åˆ™</h3>
        <ol>
            <li>æ‰€æœ‰éº»å°†ç‰Œ<strong>ä¸è§„åˆ™æ•£è½</strong>åœ¨æ¸¸æˆæ¿ä¸Šï¼Œæœ‰éšæœºæ—‹è½¬è§’åº¦</li>
            <li>ç‰Œä¸ç‰Œ<strong>äº’ç›¸é‡å é®æŒ¡</strong>ï¼Œåªè¦æœ‰<strong>éœ²å‡ºéƒ¨åˆ†</strong>å°±å¯ä»¥ç‚¹å‡»æ‹¿å–</li>
            <li>ç‚¹å‡»ä¸»æ¸¸æˆåŒºçš„ç‰Œï¼Œå°†å…¶ç§»åˆ°<strong>æ‘†æ”¾æ¡†</strong>ï¼ˆæœ€å¤š8å¼ ç‰Œï¼‰</li>
            <li>å½“æ‘†æ”¾æ¡†ä¸­æœ‰<strong>3å¼ ç›¸åŒç±»å‹</strong>çš„ç‰Œæ—¶ï¼Œä¼šè‡ªåŠ¨æ¶ˆé™¤å¹¶è·å¾—åˆ†æ•°</li>
            <li>æ¯æ¬¡æˆåŠŸæ¶ˆé™¤è·å¾—<strong>100åˆ†</strong>ï¼Œè¿ç»­æ¶ˆé™¤å¯è·å¾—é¢å¤–åŠ åˆ†</li>
            <li><strong>å…³å¡ç³»ç»Ÿ</strong>ï¼šå…±10å…³ï¼Œæ¯å…³éš¾åº¦é€’å¢ï¼Œç‰Œçš„ç§ç±»å’Œæ•°é‡å¢åŠ </li>
            <li><strong>å¤±è´¥æ¡ä»¶</strong>ï¼šæ‘†æ”¾æ¡†è¾¾åˆ°8å¼ ç‰Œæ—¶æ¸¸æˆå¤±è´¥ï¼Œé‡æ–°å¼€å§‹æ¸¸æˆ</li>
        </ol>
    </div>
    
    <div class="game-over" id="game-over">
        <div class="game-over-content">
            <h2 id="game-result">æ­å–œè¿‡å…³ï¼</h2>
            <p id="result-message">ä½ æˆåŠŸæ¶ˆé™¤äº†æ‰€æœ‰éº»å°†ç‰Œï¼</p>
            <div class="final-score">å½“å‰å¾—åˆ†: <span id="final-score">0</span></div>
            <div class="level-indicator-large">å…³å¡: <span id="final-level">1</span></div>
            <div class="game-over-buttons">
                <button class="btn" id="next-level-btn">
                    <i class="fas fa-forward"></i> ä¸‹ä¸€å…³
                </button>
                <button class="btn btn-restart" id="game-over-restart-btn">
                    <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                </button>
            </div>
        </div>
    </div>
    
    <div class="game-over" id="game-fail">
        <div class="game-over-content">
            <h2 id="game-fail-result">æ¸¸æˆå¤±è´¥</h2>
            <p id="fail-message">æ‘†æ”¾æ¡†å·²æ»¡ï¼æ¸¸æˆç»“æŸã€‚</p>
            <div class="final-score">å¾—åˆ†: <span id="fail-score">0</span></div>
            <div class="level-indicator-large">å…³å¡: <span id="fail-level">1</span></div>
            <div class="game-over-buttons">
                <button class="btn" id="fail-restart-btn">
                    <i class="fas fa-play"></i> é‡æ–°å¼€å§‹
                </button>
            </div>
        </div>
    </div>
    
    <div class="completion-animation" id="completion-animation">
        <div class="completion-content">
            <h2 class="completion-title"><i class="fas fa-trophy"></i> é€šå…³æˆåŠŸï¼</h2>
            <p class="completion-message">æ­å–œä½ é€šè¿‡äº†æ‰€æœ‰10ä¸ªå…³å¡ï¼</p>
            <div class="completion-score">æœ€ç»ˆå¾—åˆ†: <span id="completion-score">0</span></div>
            <p class="completion-message">ä½ å·²ç»æˆä¸ºéº»å°†æ¶ˆæ¶ˆä¹å¤§å¸ˆï¼</p>
            <button class="btn" id="completion-restart-btn">
                <i class="fas fa-play-circle"></i> é‡æ–°å¼€å§‹æ¸¸æˆ
            </button>
        </div>
    </div>
    
    <div class="scoreboard-modal" id="scoreboard-modal">
        <div class="scoreboard-content">
            <h2><i class="fas fa-trophy"></i> ç§¯åˆ†æ¦œ</h2>
            <div class="scoreboard-item">
                <div class="scoreboard-label">æœ€é«˜ç§¯åˆ†</div>
                <div class="scoreboard-value" id="high-score">0</div>
            </div>
            <button class="btn" id="close-scoreboard-btn">
                <i class="fas fa-times"></i> å…³é—­
            </button>
        </div>
    </div>
    
    <div class="footer">
        <p>ç«ç¾½éº»å°†æ¶ˆæ¶ˆä¹ - ä¸è§„åˆ™æ•£è½æ‰‹æœºç‰ˆ</p>
        <p class="company-logo">Â© 2023 ç«ç¾½ä¼ åª’å…¬å¸ ç‰ˆæƒæ‰€æœ‰</p>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const config = {
            totalLevels: 10, // æ€»å…³å¡æ•°
            tilesPerMatch: 3, // éœ€è¦åŒ¹é…çš„æ•°é‡
            baseScore: 100, // åŸºç¡€å¾—åˆ†
            maxSlots: 8, // æ‘†æ”¾æ¡†æœ€å¤§æ•°é‡
            level: 1, // å½“å‰å…³å¡
            // å¤§å¹…æå‡éš¾åº¦ï¼šç¬¬10å…³è¾¾åˆ°210å¼ ç‰Œ
            levelConfig: [
                {typeCount: 3, tilesPerType: 3},      // ç¬¬1å…³ï¼š3ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±9å¼ 
                {typeCount: 5, tilesPerType: 3},      // ç¬¬2å…³ï¼š5ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±15å¼ 
                {typeCount: 8, tilesPerType: 3},      // ç¬¬3å…³ï¼š8ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±24å¼ 
                {typeCount: 12, tilesPerType: 3},     // ç¬¬4å…³ï¼š12ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±36å¼ 
                {typeCount: 16, tilesPerType: 3},     // ç¬¬5å…³ï¼š16ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±48å¼ 
                {typeCount: 20, tilesPerType: 3},     // ç¬¬6å…³ï¼š20ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±60å¼ 
                {typeCount: 25, tilesPerType: 3},     // ç¬¬7å…³ï¼š25ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±75å¼ 
                {typeCount: 30, tilesPerType: 3},     // ç¬¬8å…³ï¼š30ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±90å¼ 
                {typeCount: 40, tilesPerType: 3},     // ç¬¬9å…³ï¼š40ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±120å¼ 
                {typeCount: 70, tilesPerType: 3}      // ç¬¬10å…³ï¼š70ç§ç‰Œï¼Œæ¯ç§3å¼ ï¼Œå…±210å¼ 
            ]
        };

        // æ‰©å±•éº»å°†ç‰Œå‹å®šä¹‰ï¼ˆåŒ…å«æ‰€æœ‰å¸¸è§ç‰Œå‹ï¼Œå¹¶å¢åŠ é‡å¤ä»¥æ»¡è¶³210å¼ ç‰Œçš„éœ€æ±‚ï¼‰
        const mahjongTiles = [
            // é£ç‰Œ
            { symbol: "ğŸ€€", id: "east", type: "wind", class: "wind" },
            { symbol: "ğŸ€", id: "south", type: "wind", class: "wind" },
            { symbol: "ğŸ€‚", id: "west", type: "wind", class: "wind" },
            { symbol: "ğŸ€ƒ", id: "north", type: "wind", class: "wind" },
            
            // ç®­ç‰Œï¼ˆä¸‰å…ƒç‰Œï¼‰
            { symbol: "ğŸ€„", id: "red", type: "dragon", class: "dragon" },
            { symbol: "ğŸ€…", id: "green", type: "dragon", class: "dragon" },
            { symbol: "ğŸ€†", id: "white", type: "dragon", class: "dragon" },
            
            // ä¸‡å­
            { symbol: "ğŸ€‡", id: "1man", type: "character", class: "character" },
            { symbol: "ğŸ€ˆ", id: "2man", type: "character", class: "character" },
            { symbol: "ğŸ€‰", id: "3man", type: "character", class: "character" },
            { symbol: "ğŸ€Š", id: "4man", type: "character", class: "character" },
            { symbol: "ğŸ€‹", id: "5man", type: "character", class: "character" },
            { symbol: "ğŸ€Œ", id: "6man", type: "character", class: "character" },
            { symbol: "ğŸ€", id: "7man", type: "character", class: "character" },
            { symbol: "ğŸ€", id: "8man", type: "character", class: "character" },
            { symbol: "ğŸ€", id: "9man", type: "character", class: "character" },
            
            // ç­’å­
            { symbol: "ğŸ€™", id: "1pin", type: "circle", class: "circle" },
            { symbol: "ğŸ€š", id: "2pin", type: "circle", class: "circle" },
            { symbol: "ğŸ€›", id: "3pin", type: "circle", class: "circle" },
            { symbol: "ğŸ€œ", id: "4pin", type: "circle", class: "circle" },
            { symbol: "ğŸ€", id: "5pin", type: "circle", class: "circle" },
            { symbol: "ğŸ€", id: "6pin", type: "circle", class: "circle" },
            { symbol: "ğŸ€Ÿ", id: "7pin", type: "circle", class: "circle" },
            { symbol: "ğŸ€ ", id: "8pin", type: "circle", class: "circle" },
            { symbol: "ğŸ€¡", id: "9pin", type: "circle", class: "circle" },
            
            // æ¡å­
            { symbol: "ğŸ€", id: "1sou", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€‘", id: "2sou", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€’", id: "3sou", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€“", id: "4sou", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€”", id: "5sou", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€•", id: "6sou", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€–", id: "7sou", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€—", id: "8sou", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€˜", id: "9sou", type: "bamboo", class: "bamboo" },
            
            // èŠ±ç‰Œï¼ˆç”¨äºåæœŸå¢åŠ éš¾åº¦ï¼‰
            { symbol: "ğŸ€¢", id: "flower1", type: "flower", class: "flower" },
            { symbol: "ğŸ€£", id: "flower2", type: "flower", class: "flower" },
            { symbol: "ğŸ€¤", id: "flower3", type: "flower", class: "flower" },
            { symbol: "ğŸ€¥", id: "flower4", type: "flower", class: "flower" },
            { symbol: "ğŸ€¦", id: "season1", type: "season", class: "season" },
            { symbol: "ğŸ€§", id: "season2", type: "season", class: "season" },
            { symbol: "ğŸ€¨", id: "season3", type: "season", class: "season" },
            { symbol: "ğŸ€©", id: "season4", type: "season", class: "season" },
            
            // é‡å¤ç‰Œå‹ä»¥æ»¡è¶³é«˜å…³å¡éœ€æ±‚ï¼ˆç°å®éº»å°†åªæœ‰34ç§ç‰Œï¼Œè¿™é‡Œé‡å¤ä»¥å‡‘å¤Ÿ70ç§ï¼‰
            { symbol: "ğŸ€€", id: "east2", type: "wind", class: "wind" },
            { symbol: "ğŸ€", id: "south2", type: "wind", class: "wind" },
            { symbol: "ğŸ€‚", id: "west2", type: "wind", class: "wind" },
            { symbol: "ğŸ€ƒ", id: "north2", type: "wind", class: "wind" },
            { symbol: "ğŸ€„", id: "red2", type: "dragon", class: "dragon" },
            { symbol: "ğŸ€…", id: "green2", type: "dragon", class: "dragon" },
            { symbol: "ğŸ€†", id: "white2", type: "dragon", class: "dragon" },
            { symbol: "ğŸ€‡", id: "1man2", type: "character", class: "character" },
            { symbol: "ğŸ€ˆ", id: "2man2", type: "character", class: "character" },
            { symbol: "ğŸ€‰", id: "3man2", type: "character", class: "character" },
            { symbol: "ğŸ€Š", id: "4man2", type: "character", class: "character" },
            { symbol: "ğŸ€‹", id: "5man2", type: "character", class: "character" },
            { symbol: "ğŸ€Œ", id: "6man2", type: "character", class: "character" },
            { symbol: "ğŸ€", id: "7man2", type: "character", class: "character" },
            { symbol: "ğŸ€", id: "8man2", type: "character", class: "character" },
            { symbol: "ğŸ€", id: "9man2", type: "character", class: "character" },
            { symbol: "ğŸ€™", id: "1pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€š", id: "2pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€›", id: "3pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€œ", id: "4pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€", id: "5pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€", id: "6pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€Ÿ", id: "7pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€ ", id: "8pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€¡", id: "9pin2", type: "circle", class: "circle" },
            { symbol: "ğŸ€", id: "1sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€‘", id: "2sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€’", id: "3sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€“", id: "4sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€”", id: "5sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€•", id: "6sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€–", id: "7sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€—", id: "8sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€˜", id: "9sou2", type: "bamboo", class: "bamboo" },
            { symbol: "ğŸ€¢", id: "flower5", type: "flower", class: "flower" },
            { symbol: "ğŸ€£", id: "flower6", type: "flower", class: "flower" },
            { symbol: "ğŸ€¤", id: "flower7", type: "flower", class: "flower" },
            { symbol: "ğŸ€¥", id: "flower8", type: "flower", class: "flower" },
            { symbol: "ğŸ€¦", id: "season5", type: "season", class: "season" },
            { symbol: "ğŸ€§", id: "season6", type: "season", class: "season" },
            { symbol: "ğŸ€¨", id: "season7", type: "season", class: "season" },
            { symbol: "ğŸ€©", id: "season8", type: "season", class: "season" },
            { symbol: "ğŸ€€", id: "east3", type: "wind", class: "wind" },
            { symbol: "ğŸ€", id: "south3", type: "wind", class: "wind" },
            { symbol: "ğŸ€‚", id: "west3", type: "wind", class: "wind" },
            { symbol: "ğŸ€ƒ", id: "north3", type: "wind", class: "wind" },
            { symbol: "ğŸ€„", id: "red3", type: "dragon", class: "dragon" },
            { symbol: "ğŸ€…", id: "green3", type: "dragon", class: "dragon" },
            { symbol: "ğŸ€†", id: "white3", type: "dragon", class: "dragon" }
        ];

        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            score: 0,
            remainingTiles: 0,
            selectedTiles: [], // å·²é€‰æ‹©çš„ç‰Œï¼ˆä»æ‘†æ”¾æ¡†ä¸­é€‰æ‹©ï¼‰
            tiles: [], // æ‰€æœ‰éº»å°†ç‰Œ
            placeholderTiles: [], // æ‘†æ”¾æ¡†ä¸­çš„ç‰Œ
            combo: 0,
            isGameOver: false,
            level: config.level,
            // ç§¯åˆ†æ¦œæ•°æ®ï¼ˆåªä¿ç•™æœ€é«˜åˆ†æ•°ï¼‰
            highScore: 0,
            isGameComplete: false // æ ‡è®°æ¸¸æˆæ˜¯å¦é€šå…³
        };

        // DOM å…ƒç´ 
        const mainBoard = document.getElementById('main-board');
        const tileContainer = document.getElementById('tile-container');
        const placeholderSlots = document.getElementById('placeholder-slots');
        const scoreElement = document.getElementById('score');
        const remainingElement = document.getElementById('remaining');
        const levelElement = document.getElementById('level');
        const slotsUsedElement = document.getElementById('slots-used');
        const selectedTilesContainer = document.getElementById('selected-tiles');
        const hintBtn = document.getElementById('hint-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const restartBtn = document.getElementById('restart-btn');
        const scoreboardBtn = document.getElementById('scoreboard-btn');
        const gameOverElement = document.getElementById('game-over');
        const gameResultElement = document.getElementById('game-result');
        const resultMessageElement = document.getElementById('result-message');
        const finalScoreElement = document.getElementById('final-score');
        const finalLevelElement = document.getElementById('final-level');
        const nextLevelBtn = document.getElementById('next-level-btn');
        const gameOverRestartBtn = document.getElementById('game-over-restart-btn');
        const gameFailElement = document.getElementById('game-fail');
        const gameFailResultElement = document.getElementById('game-fail-result');
        const failMessageElement = document.getElementById('fail-message');
        const failScoreElement = document.getElementById('fail-score');
        const failLevelElement = document.getElementById('fail-level');
        const failRestartBtn = document.getElementById('fail-restart-btn');
        const scoreboardModal = document.getElementById('scoreboard-modal');
        const highScoreElement = document.getElementById('high-score');
        const closeScoreboardBtn = document.getElementById('close-scoreboard-btn');
        const completionAnimation = document.getElementById('completion-animation');
        const completionScoreElement = document.getElementById('completion-score');
        const completionRestartBtn = document.getElementById('completion-restart-btn');

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            gameState.score = 0;
            gameState.selectedTiles = [];
            gameState.tiles = [];
            gameState.placeholderTiles = [];
            gameState.combo = 0;
            gameState.isGameOver = false;
            gameState.level = config.level;
            gameState.isGameComplete = false;
            
            const levelConfig = config.levelConfig[gameState.level - 1];
            gameState.remainingTiles = levelConfig.typeCount * levelConfig.tilesPerType;
            
            // åŠ è½½ç§¯åˆ†æ¦œæ•°æ®
            loadScoreboard();
            
            updateUI();
            generateTiles();
            arrangeTilesRandomly();
            renderTiles();
            renderPlaceholderSlots();
            renderSelectedTiles();
            hideGameOver();
            hideGameFail();
        }

        // å¼€å§‹æ–°å…³å¡ï¼ˆä¸é‡ç½®åˆ†æ•°ï¼‰
        function startNewLevel() {
            gameState.selectedTiles = [];
            gameState.tiles = [];
            gameState.placeholderTiles = [];
            gameState.combo = 0;
            gameState.isGameOver = false;
            
            const levelConfig = config.levelConfig[gameState.level - 1];
            gameState.remainingTiles = levelConfig.typeCount * levelConfig.tilesPerType;
            
            updateUI();
            generateTiles();
            arrangeTilesRandomly();
            renderTiles();
            renderPlaceholderSlots();
            renderSelectedTiles();
            hideGameOver();
            hideGameFail();
        }

        // è¿›å…¥ä¸‹ä¸€å…³
        function nextLevel() {
            if (gameState.level < config.totalLevels) {
                gameState.level++;
                config.level = gameState.level;
                hideGameOver();
                startNewLevel();
            } else {
                // é€šå…³æ‰€æœ‰å…³å¡
                hideGameOver();
                setTimeout(() => {
                    showCompletionAnimation();
                }, 500);
            }
        }

        // æ˜¾ç¤ºå…³å¡å‡çº§é€šçŸ¥
        function showLevelUpNotification() {
            const notification = document.createElement('div');
            notification.className = 'level-up-notification';
            notification.innerHTML = `ç¬¬ ${gameState.level} å…³ï¼`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }

        // ç”Ÿæˆéº»å°†ç‰Œï¼ˆæ ¹æ®å½“å‰å…³å¡é…ç½®ï¼‰
        function generateTiles() {
            gameState.tiles = [];
            
            const levelConfig = config.levelConfig[gameState.level - 1];
            
            // è·å–å½“å‰å…³å¡è¦ä½¿ç”¨çš„ç‰Œå‹ï¼ˆéšæœºé€‰æ‹©ï¼‰
            const availableTiles = [...mahjongTiles];
            shuffleArray(availableTiles);
            
            // é€‰æ‹©å‰ typeCount ç§ç‰Œ
            const selectedTileTypes = availableTiles.slice(0, levelConfig.typeCount);
            
            // æ¯ç§ç‰Œç”Ÿæˆ tilesPerType å¼ 
            selectedTileTypes.forEach(tileType => {
                for (let i = 0; i < levelConfig.tilesPerType; i++) {
                    gameState.tiles.push({
                        ...tileType,
                        uniqueId: `${tileType.id}-${i}-${Date.now()}-${Math.random()}`,
                        selected: false,
                        x: 0, // ä½ç½®å°†åœ¨arrangeTilesRandomlyä¸­è®¾ç½®
                        y: 0,
                        rotation: 0,
                        zIndex: 1,
                        clickable: true, // æ‰€æœ‰æœ‰éœ²å‡ºéƒ¨åˆ†çš„ç‰Œéƒ½å¯ç‚¹å‡»
                        visible: true,
                        removed: false,
                        inPlaceholder: false // æ˜¯å¦åœ¨æ‘†æ”¾æ¡†ä¸­
                    });
                }
            });
            
            // æ‰“ä¹±éº»å°†ç‰Œé¡ºåº
            shuffleArray(gameState.tiles);
        }

        // éšæœºæ•£è½æ’åˆ—éº»å°†ç‰Œ
        function arrangeTilesRandomly() {
            // æ¸…ç©ºå®¹å™¨
            tileContainer.innerHTML = '';
            
            // è®¡ç®—ä¸»æ¸¸æˆåŒºå°ºå¯¸
            const boardWidth = mainBoard.offsetWidth;
            const boardHeight = mainBoard.offsetHeight;
            
            // ç‰Œçš„åŸºæœ¬å°ºå¯¸
            const baseTileWidth = 60;
            const baseTileHeight = 75;
            
            // æ ¹æ®å…³å¡è°ƒæ•´ç‰Œçš„å¤§å°ï¼ˆåæœŸå…³å¡ç‰Œå˜å°ï¼Œå¢åŠ éš¾åº¦ï¼‰
            // ç¬¬1å…³ï¼š100%å¤§å°ï¼Œç¬¬10å…³ï¼š30%å¤§å°
            const sizeMultiplier = Math.max(0.3, 1 - (gameState.level - 1) * 0.078);
            const tileWidth = baseTileWidth * sizeMultiplier;
            const tileHeight = baseTileHeight * sizeMultiplier;
            
            // ç”¨äºè®°å½•å·²æ”¾ç½®ç‰Œçš„ä½ç½®ï¼Œç”¨äºç¢°æ’æ£€æµ‹
            const placedTiles = [];
            
            // ä¸ºæ¯å¼ ç‰Œè®¾ç½®éšæœºä½ç½®å’Œæ—‹è½¬è§’åº¦
            gameState.tiles.forEach((tile, index) => {
                // é‡ç½®ç‰Œçš„çŠ¶æ€
                tile.removed = false;
                tile.inPlaceholder = false;
                tile.selected = false;
                tile.clickable = true;
                
                let attempts = 0;
                let placed = false;
                
                // å°è¯•æ”¾ç½®ç‰Œï¼Œæœ€å¤šå°è¯•æ¬¡æ•°æ ¹æ®å…³å¡å¢åŠ 
                const maxAttempts = 50 + (gameState.level * 10);
                
                while (!placed && attempts < maxAttempts) {
                    // éšæœºä½ç½®ï¼ˆè€ƒè™‘ç‰Œåœ¨è¾¹ç•Œå†…ï¼‰
                    const x = Math.random() * (boardWidth - tileWidth * 0.6);
                    const y = Math.random() * (boardHeight - tileHeight * 0.6);
                    
                    // éšæœºæ—‹è½¬è§’åº¦ï¼ˆ-45åº¦åˆ°45åº¦ï¼‰
                    const rotation = (Math.random() - 0.5) * 90;
                    
                    // éšæœºz-indexï¼ˆ1-100ï¼‰
                    const zIndex = Math.floor(Math.random() * 100) + 1;
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸å·²æ”¾ç½®çš„ç‰Œæœ‰å¤ªå¤šé‡å 
                    let overlapTooMuch = false;
                    
                    // è®¡ç®—å½“å‰ç‰Œçš„è¾¹ç•Œï¼ˆè€ƒè™‘æ—‹è½¬ï¼‰
                    const tileBounds = calculateRotatedBounds(x, y, tileWidth, tileHeight, rotation);
                    
                    // æ£€æŸ¥ä¸å·²æ”¾ç½®ç‰Œçš„ç¢°æ’
                    for (const placedTile of placedTiles) {
                        // è®¡ç®—é‡å é¢ç§¯
                        const overlap = calculateOverlapArea(tileBounds, placedTile.bounds);
                        
                        // åæœŸå…³å¡å…è®¸æ›´å¤šé‡å ï¼Œå¢åŠ å †å ç¨‹åº¦
                        const overlapThreshold = 0.6 - (gameState.level * 0.03);
                        if (overlap > tileWidth * tileHeight * overlapThreshold) {
                            overlapTooMuch = true;
                            break;
                        }
                    }
                    
                    // å¦‚æœæ²¡æœ‰å¤ªå¤šé‡å ï¼Œåˆ™æ”¾ç½®ç‰Œ
                    if (!overlapTooMuch) {
                        tile.x = x;
                        tile.y = y;
                        tile.rotation = rotation;
                        tile.zIndex = zIndex;
                        tile.clickable = true;
                        tile.inPlaceholder = false;
                        
                        // è®°å½•ç‰Œçš„ä½ç½®å’Œè¾¹ç•Œ
                        placedTiles.push({
                            tile: tile,
                            bounds: tileBounds
                        });
                        
                        placed = true;
                    }
                    
                    attempts++;
                }
                
                // å¦‚æœå¤šæ¬¡å°è¯•åä»æœªæ”¾ç½®ï¼Œåˆ™å¼ºåˆ¶æ”¾ç½®åœ¨ä¸€ä¸ªéšæœºä½ç½®
                if (!placed) {
                    tile.x = Math.random() * (boardWidth - tileWidth);
                    tile.y = Math.random() * (boardHeight - tileHeight);
                    tile.rotation = (Math.random() - 0.5) * 90;
                    tile.zIndex = Math.floor(Math.random() * 100) + 1;
                    tile.clickable = true;
                    tile.inPlaceholder = false;
                }
            });
            
            // æ›´æ–°æ¯å¼ ç‰Œçš„å¯ç‚¹å‡»çŠ¶æ€ï¼ˆæ¨¡æ‹Ÿéƒ¨åˆ†è¢«é®æŒ¡ï¼‰
            updateClickableTiles();
        }

        // è®¡ç®—æ—‹è½¬åçš„è¾¹ç•Œ
        function calculateRotatedBounds(x, y, width, height, rotation) {
            // å°†è§’åº¦è½¬æ¢ä¸ºå¼§åº¦
            const rad = rotation * Math.PI / 180;
            
            // è®¡ç®—å››ä¸ªè§’çš„åæ ‡
            const cx = x + width / 2;
            const cy = y + height / 2;
            
            // å››ä¸ªè§’çš„ç›¸å¯¹åæ ‡
            const corners = [
                {x: -width/2, y: -height/2},
                {x: width/2, y: -height/2},
                {x: width/2, y: height/2},
                {x: -width/2, y: height/2}
            ];
            
            // æ—‹è½¬åçš„è§’åæ ‡
            const rotatedCorners = corners.map(corner => {
                return {
                    x: cx + corner.x * Math.cos(rad) - corner.y * Math.sin(rad),
                    y: cy + corner.x * Math.sin(rad) + corner.y * Math.cos(rad)
                };
            });
            
            // è®¡ç®—è¾¹ç•Œæ¡†
            const xs = rotatedCorners.map(c => c.x);
            const ys = rotatedCorners.map(c => c.y);
            
            return {
                minX: Math.min(...xs),
                maxX: Math.max(...xs),
                minY: Math.min(...ys),
                maxY: Math.max(...ys),
                corners: rotatedCorners
            };
        }

        // è®¡ç®—ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„é‡å é¢ç§¯ï¼ˆç®€åŒ–è®¡ç®—ï¼Œä½¿ç”¨çŸ©å½¢è¿‘ä¼¼ï¼‰
        function calculateOverlapArea(bounds1, bounds2) {
            // è®¡ç®—é‡å çŸ©å½¢çš„åæ ‡
            const overlapX = Math.max(0, Math.min(bounds1.maxX, bounds2.maxX) - Math.max(bounds1.minX, bounds2.minX));
            const overlapY = Math.max(0, Math.min(bounds1.maxY, bounds2.maxY) - Math.max(bounds1.minY, bounds2.minY));
            
            return overlapX * overlapY;
        }

        // æ›´æ–°å¯ç‚¹å‡»çŠ¶æ€
        function updateClickableTiles() {
            // æŒ‰z-indexæ’åº
            const sortedTiles = [...gameState.tiles].filter(t => !t.removed && !t.inPlaceholder).sort((a, b) => a.zIndex - b.zIndex);
            
            // å¯¹äºæ¯å¼ ç‰Œï¼Œæ£€æŸ¥æ˜¯å¦è¢«ä¸Šå±‚ç‰Œå®Œå…¨é®æŒ¡
            sortedTiles.forEach((tile, index) => {
                // æ£€æŸ¥æ˜¯å¦æœ‰ä¸Šå±‚ç‰Œå®Œå…¨è¦†ç›–å½“å‰ç‰Œçš„ä¸­å¿ƒç‚¹
                const centerX = tile.x + 30;
                const centerY = tile.y + 37.5;
                
                let isCenterCovered = false;
                
                // æ£€æŸ¥æ‰€æœ‰z-indexå¤§äºå½“å‰ç‰Œçš„ç‰Œ
                for (let i = index + 1; i < sortedTiles.length; i++) {
                    const upperTile = sortedTiles[i];
                    // æ£€æŸ¥å½“å‰ç‰Œçš„ä¸­å¿ƒç‚¹æ˜¯å¦åœ¨ä¸Šå±‚ç‰Œå†…
                    if (isPointInRotatedRectangle(centerX, centerY, upperTile.x, upperTile.y, 60, 75, upperTile.rotation)) {
                        isCenterCovered = true;
                        break;
                    }
                }
                
                // å¦‚æœä¸­å¿ƒç‚¹è¢«è¦†ç›–ï¼Œæ£€æŸ¥å››ä¸ªè§’æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªå¯è§
                if (isCenterCovered) {
                    const corners = [
                        {x: tile.x + 5, y: tile.y + 5}, // å·¦ä¸Šè§’
                        {x: tile.x + 55, y: tile.y + 5}, // å³ä¸Šè§’
                        {x: tile.x + 5, y: tile.y + 70}, // å·¦ä¸‹è§’
                        {x: tile.x + 55, y: tile.y + 70} // å³ä¸‹è§’
                    ];
                    
                    let visibleCornerFound = false;
                    
                    for (const corner of corners) {
                        let isCornerCovered = false;
                        
                        // æ£€æŸ¥æ‰€æœ‰ä¸Šå±‚ç‰Œæ˜¯å¦è¦†ç›–è¿™ä¸ªè§’
                        for (let i = index + 1; i < sortedTiles.length; i++) {
                            const upperTile = sortedTiles[i];
                            if (isPointInRotatedRectangle(corner.x, corner.y, upperTile.x, upperTile.y, 60, 75, upperTile.rotation)) {
                                isCornerCovered = true;
                                break;
                            }
                        }
                        
                        if (!isCornerCovered) {
                            visibleCornerFound = true;
                            break;
                        }
                    }
                    
                    tile.clickable = visibleCornerFound;
                } else {
                    tile.clickable = true;
                }
            });
        }

        // æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨æ—‹è½¬çŸ©å½¢å†…
        function isPointInRotatedRectangle(px, py, rx, ry, width, height, rotation) {
            // å°†è§’åº¦è½¬æ¢ä¸ºå¼§åº¦
            const rad = -rotation * Math.PI / 180;
            
            // çŸ©å½¢ä¸­å¿ƒç‚¹
            const cx = rx + width / 2;
            const cy = ry + height / 2;
            
            // å°†ç‚¹è½¬æ¢åˆ°çŸ©å½¢å±€éƒ¨åæ ‡ç³»
            const dx = px - cx;
            const dy = py - cy;
            
            // æ—‹è½¬ç‚¹
            const rotatedX = dx * Math.cos(rad) - dy * Math.sin(rad);
            const rotatedY = dx * Math.sin(rad) + dy * Math.cos(rad);
            
            // æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨çŸ©å½¢å†…
            return Math.abs(rotatedX) <= width / 2 && Math.abs(rotatedY) <= height / 2;
        }

        // æ¸²æŸ“éº»å°†ç‰Œ
        function renderTiles() {
            tileContainer.innerHTML = '';
            
            // æŒ‰z-indexæ’åºï¼Œç¡®ä¿æ­£ç¡®æ¸²æŸ“
            const sortedTiles = [...gameState.tiles].filter(t => !t.removed && !t.inPlaceholder).sort((a, b) => a.zIndex - b.zIndex);
            
            sortedTiles.forEach(tile => {
                const tileElement = createTileElement(tile);
                tileContainer.appendChild(tileElement);
            });
            
            // æ›´æ–°å‰©ä½™ç‰Œæ•°
            updateRemainingCount();
        }

        // åˆ›å»ºéº»å°†ç‰Œå…ƒç´ 
        function createTileElement(tile) {
            // æ ¹æ®å…³å¡è°ƒæ•´ç‰Œçš„å¤§å°
            const sizeMultiplier = Math.max(0.3, 1 - (gameState.level - 1) * 0.078);
            const tileWidth = 60 * sizeMultiplier;
            const tileHeight = 75 * sizeMultiplier;
            
            const tileElement = document.createElement('div');
            tileElement.className = `tile`;
            tileElement.dataset.id = tile.uniqueId;
            tileElement.style.left = `${tile.x}px`;
            tileElement.style.top = `${tile.y}px`;
            tileElement.style.transform = `rotate(${tile.rotation}deg)`;
            tileElement.style.zIndex = tile.zIndex;
            tileElement.style.width = `${tileWidth}px`;
            tileElement.style.height = `${tileHeight}px`;
            
            if (tile.selected) {
                tileElement.classList.add('selected');
            }
            
            if (!tile.clickable) {
                tileElement.style.opacity = '0.5';
                tileElement.style.cursor = 'not-allowed';
            }
            
            // éº»å°†ç‰Œå†…å®¹ï¼ˆåªæ˜¾ç¤ºç¬¦å·ï¼Œä¸æ˜¾ç¤ºä¸­æ–‡åç§°ï¼Œç¬¦å·æœ€å¤§åŒ–ï¼‰
            tileElement.innerHTML = `
                <div class="tile-symbol ${tile.class}">${tile.symbol}</div>
                ${tile.clickable ? '<div class="clickable-indicator"></div>' : ''}
            `;
            
            // ç‚¹å‡»äº‹ä»¶ï¼ˆåªæœ‰å¯ç‚¹å‡»çš„ç‰Œæ‰èƒ½è¢«ç‚¹å‡»ï¼‰
            if (tile.clickable) {
                tileElement.addEventListener('click', () => moveTileToPlaceholder(tile));
                
                // è§¦æ‘¸åé¦ˆ
                tileElement.addEventListener('touchstart', function() {
                    this.style.transform = `rotate(${tile.rotation}deg) scale(1.05)`;
                });
                
                tileElement.addEventListener('touchend', function() {
                    this.style.transform = `rotate(${tile.rotation}deg)`;
                });
            }
            
            return tileElement;
        }

        // æ¸²æŸ“æ‘†æ”¾æ¡†
        function renderPlaceholderSlots() {
            placeholderSlots.innerHTML = '';
            
            // åˆ›å»º8ä¸ªæ‘†æ”¾æ¡†
            for (let i = 0; i < config.maxSlots; i++) {
                const slotElement = document.createElement('div');
                slotElement.className = 'slot';
                slotElement.dataset.index = i;
                
                // å¦‚æœè¯¥ä½ç½®æœ‰ç‰Œ
                if (i < gameState.placeholderTiles.length) {
                    const tile = gameState.placeholderTiles[i];
                    slotElement.classList.add('occupied');
                    slotElement.innerHTML = `
                        <div class="tile-symbol ${tile.class}">${tile.symbol}</div>
                    `;
                } else {
                    slotElement.textContent = i + 1;
                }
                
                placeholderSlots.appendChild(slotElement);
            }
            
            // æ›´æ–°æ‘†æ”¾æ¡†ä½¿ç”¨æƒ…å†µ
            updateSlotsUsed();
        }

        // æ¸²æŸ“å·²é€‰æ‹©çš„éº»å°†ç‰Œ
        function renderSelectedTiles() {
            selectedTilesContainer.innerHTML = '';
            
            if (gameState.selectedTiles.length === 0) {
                selectedTilesContainer.innerHTML = '<div class="empty-selection">å½“æ‘†æ”¾æ¡†ä¸­æœ‰3å¼ ç›¸åŒç‰Œæ—¶ä¼šè‡ªåŠ¨æ¶ˆé™¤</div>';
                return;
            }
            
            gameState.selectedTiles.forEach(tile => {
                const selectedTileElement = document.createElement('div');
                selectedTileElement.className = 'selected-tile';
                
                selectedTileElement.innerHTML = `
                    <div class="tile-symbol ${tile.class}">${tile.symbol}</div>
                `;
                
                selectedTilesContainer.appendChild(selectedTileElement);
            });
        }

        // å°†ä¸»æ¸¸æˆåŒºçš„ç‰Œç§»åŠ¨åˆ°æ‘†æ”¾æ¡†
        function moveTileToPlaceholder(tile) {
            // æ£€æŸ¥æ‘†æ”¾æ¡†æ˜¯å¦å·²æ»¡
            if (gameState.placeholderTiles.length >= config.maxSlots) {
                // æ‘†æ”¾æ¡†è¾¾åˆ°8å¼ ç‰Œï¼Œæ¸¸æˆå¤±è´¥ï¼Œé‡æ–°å¼€å§‹æ¸¸æˆ
                showGameFail();
                return;
            }
            
            // æ ‡è®°ç‰Œä¸ºåœ¨æ‘†æ”¾æ¡†ä¸­
            const tileIndex = gameState.tiles.findIndex(t => t.uniqueId === tile.uniqueId);
            if (tileIndex !== -1) {
                gameState.tiles[tileIndex].inPlaceholder = true;
                gameState.tiles[tileIndex].selected = false;
            }
            
            // å°†ç‰Œæ·»åŠ åˆ°æ‘†æ”¾æ¡†
            gameState.placeholderTiles.push({...tile});
            
            // æ›´æ–°å¯ç‚¹å‡»çŠ¶æ€ï¼ˆç§»é™¤ç‰Œåï¼Œä¸‹é¢çš„ç‰Œå¯èƒ½å˜å¾—å¯ç‚¹å‡»ï¼‰
            updateClickableTiles();
            
            // æ£€æŸ¥æ‘†æ”¾æ¡†ä¸­æ˜¯å¦æœ‰3å¼ ç›¸åŒçš„ç‰Œå¯ä»¥æ¶ˆé™¤
            checkForAutoMatches();
            
            // æ›´æ–°UI
            updateUI();
            renderTiles();
            renderPlaceholderSlots();
            
            // æ’­æ”¾éŸ³æ•ˆ
            playSound('select');
            
            // æ£€æŸ¥æ‘†æ”¾æ¡†æ˜¯å¦è¾¾åˆ°8å¼ ï¼ˆå†æ¬¡æ£€æŸ¥ï¼Œå› ä¸ºå¯èƒ½åˆšæ·»åŠ äº†ä¸€å¼ ï¼‰
            if (gameState.placeholderTiles.length >= config.maxSlots) {
                // çŸ­æš‚å»¶è¿Ÿåè§¦å‘æ¸¸æˆå¤±è´¥ï¼Œé‡æ–°å¼€å§‹æ¸¸æˆ
                setTimeout(() => {
                    showGameFail();
                }, 300);
            }
        }

        // æ£€æŸ¥æ‘†æ”¾æ¡†ä¸­æ˜¯å¦æœ‰3å¼ ç›¸åŒçš„ç‰Œå¯ä»¥è‡ªåŠ¨æ¶ˆé™¤
        function checkForAutoMatches() {
            // ç»Ÿè®¡æ¯ç§ç±»å‹ç‰Œçš„æ•°é‡
            const tileCounts = {};
            gameState.placeholderTiles.forEach(tile => {
                if (!tileCounts[tile.id]) {
                    tileCounts[tile.id] = [];
                }
                tileCounts[tile.id].push(tile);
            });
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è‡³å°‘3å¼ ç›¸åŒç±»å‹çš„ç‰Œ
            for (const tileId in tileCounts) {
                if (tileCounts[tileId].length >= config.tilesPerMatch) {
                    // æ‰¾åˆ°å¯æ¶ˆé™¤çš„ç‰Œç»„
                    const matchedTiles = tileCounts[tileId].slice(0, config.tilesPerMatch);
                    
                    // æ˜¾ç¤ºè‡ªåŠ¨æ¶ˆé™¤é€šçŸ¥
                    showAutoMatchNotification(matchedTiles[0]);
                    
                    // æ¶ˆé™¤è¿™äº›ç‰Œ
                    setTimeout(() => removeMatchedTilesFromPlaceholder(matchedTiles), 500);
                    return true;
                }
            }
            
            return false;
        }

        // æ˜¾ç¤ºè‡ªåŠ¨æ¶ˆé™¤é€šçŸ¥
        function showAutoMatchNotification(tile) {
            const notification = document.createElement('div');
            notification.className = 'auto-match-notification';
            notification.innerHTML = `è‡ªåŠ¨æ¶ˆé™¤: ${tile.symbol} x3`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 1500);
        }

        // ä»æ‘†æ”¾æ¡†ä¸­ç§»é™¤åŒ¹é…çš„ç‰Œ
        function removeMatchedTilesFromPlaceholder(matchedTiles) {
            // è®¡ç®—å¾—åˆ†
            const points = config.baseScore + (gameState.combo * 20);
            gameState.score += points;
            gameState.combo++;
            
            // è®°å½•è¦ç§»é™¤çš„ç‰Œçš„uniqueId
            const matchedTileIds = matchedTiles.map(t => t.uniqueId);
            
            // ä»æ‘†æ”¾æ¡†ä¸­ç§»é™¤è¿™äº›ç‰Œ
            gameState.placeholderTiles = gameState.placeholderTiles.filter(t => 
                !matchedTileIds.includes(t.uniqueId)
            );
            
            // ä»ä¸»æ¸¸æˆåŒºå½»åº•ç§»é™¤è¿™äº›ç‰Œ
            matchedTileIds.forEach(uniqueId => {
                const tileIndex = gameState.tiles.findIndex(t => t.uniqueId === uniqueId);
                if (tileIndex !== -1) {
                    gameState.tiles[tileIndex].removed = true;
                    gameState.tiles[tileIndex].inPlaceholder = false;
                }
            });
            
            // å‡å°‘å‰©ä½™ç‰Œæ•°
            gameState.remainingTiles -= config.tilesPerMatch;
            
            // æ’­æ”¾æ¶ˆé™¤éŸ³æ•ˆ
            playSound('match');
            
            // æ›´æ–°UI
            updateUI();
            renderPlaceholderSlots();
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (gameState.remainingTiles <= 0) {
                setTimeout(() => {
                    // æ˜¾ç¤ºè¿‡å…³ç•Œé¢ï¼Œç­‰å¾…ç©å®¶ç‚¹å‡»ä¸‹ä¸€å…³
                    showGameOver();
                    playSound('win');
                }, 500);
            } else {
                // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ›´å¤šå¯è‡ªåŠ¨æ¶ˆé™¤çš„ç‰Œ
                setTimeout(() => checkForAutoMatches(), 300);
            }
        }

        // æç¤ºåŠŸèƒ½
        function showHint() {
            // æ£€æŸ¥æ‘†æ”¾æ¡†ä¸­æ˜¯å¦æœ‰å¯åŒ¹é…çš„ç‰Œ
            const tileCounts = {};
            gameState.placeholderTiles.forEach(tile => {
                if (!tileCounts[tile.id]) {
                    tileCounts[tile.id] = [];
                }
                tileCounts[tile.id].push(tile);
            });
            
            // æ‰¾åˆ°è‡³å°‘æœ‰3å¼ ç›¸åŒç±»å‹çš„ç‰Œ
            for (const tileId in tileCounts) {
                if (tileCounts[tileId].length >= config.tilesPerMatch) {
                    // é«˜äº®æ˜¾ç¤ºè¿™äº›ç‰Œ
                    tileCounts[tileId].forEach(tile => {
                        const slotIndex = gameState.placeholderTiles.findIndex(t => t.uniqueId === tile.uniqueId);
                        if (slotIndex !== -1) {
                            const slotElement = document.querySelector(`.slot[data-index="${slotIndex}"]`);
                            if (slotElement) {
                                slotElement.style.boxShadow = '0 0 10px #00ff00';
                                slotElement.style.borderColor = '#00ff00';
                                
                                // 3ç§’åå–æ¶ˆé«˜äº®
                                setTimeout(() => {
                                    slotElement.style.boxShadow = '';
                                    slotElement.style.borderColor = '';
                                }, 3000);
                            }
                        }
                    });
                    
                    // æ’­æ”¾æç¤ºéŸ³æ•ˆ
                    playSound('hint');
                    return;
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œæç¤ºç©å®¶æ‹¿å–ä¸»æ¸¸æˆåŒºçš„ç‰Œ
            const clickableTiles = gameState.tiles.filter(t => 
                !t.removed && !t.inPlaceholder && t.clickable
            );
            if (clickableTiles.length > 0) {
                // é«˜äº®æ˜¾ç¤ºä¸€ä¸ªå¯ç‚¹å‡»çš„ç‰Œ
                const randomTile = clickableTiles[Math.floor(Math.random() * clickableTiles.length)];
                const tileElement = document.querySelector(`.tile[data-id="${randomTile.uniqueId}"]`);
                if (tileElement) {
                    tileElement.classList.add('hint');
                    
                    setTimeout(() => {
                        tileElement.classList.remove('hint');
                    }, 3000);
                }
                
                alert("å»ºè®®æ‹¿å–ä¸Šå±‚ç‰Œåˆ°æ‘†æ”¾æ¡†ï¼");
            } else {
                alert("å½“å‰æ²¡æœ‰å¯æ¶ˆé™¤çš„ç‰Œç»„ï¼è¯·ä½¿ç”¨é‡æ’åŠŸèƒ½ã€‚");
            }
        }

        // é‡æ’åŠŸèƒ½ï¼ˆæ´—ç‰Œï¼‰
        function shuffleTiles() {
            // åªé‡æ’ä¸»æ¸¸æˆåŒºçš„ç‰Œï¼Œä¸é‡æ’æ”¾ç½®æ¡†çš„ç‰Œ
            const tilesInPlay = gameState.tiles.filter(t => !t.inPlaceholder && !t.removed);
            
            // é‡ç½®ç‰Œçš„çŠ¶æ€
            tilesInPlay.forEach(tile => {
                tile.clickable = true;
                tile.inPlaceholder = false;
            });
            
            // é‡æ–°æ’åˆ—ç‰Œ
            arrangeTilesRandomly();
            
            // é‡æ–°æ¸²æŸ“
            renderTiles();
            
            // æ’­æ”¾æ´—ç‰ŒéŸ³æ•ˆ
            playSound('shuffle');
            
            // æ›´æ–°UI
            updateUI();
        }

        // æ›´æ–°å‰©ä½™ç‰Œæ•°
        function updateRemainingCount() {
            let count = 0;
            gameState.tiles.forEach(tile => {
                if (!tile.removed) {
                    count++;
                }
            });
            gameState.remainingTiles = count;
            remainingElement.textContent = gameState.remainingTiles;
        }

        // æ›´æ–°æ‘†æ”¾æ¡†ä½¿ç”¨æƒ…å†µ
        function updateSlotsUsed() {
            slotsUsedElement.textContent = `${gameState.placeholderTiles.length}/${config.maxSlots}`;
            
            // å¦‚æœæ‘†æ”¾æ¡†æ¥è¿‘æ»¡ï¼Œæ˜¾ç¤ºè­¦å‘Š
            if (gameState.placeholderTiles.length >= 6) {
                slotsUsedElement.style.color = '#ff7b7b';
            } else {
                slotsUsedElement.style.color = '#ffde59';
            }
        }

        // æ˜¾ç¤ºè¿‡å…³ç•Œé¢
        function showGameOver() {
            gameState.isGameOver = true;
            finalScoreElement.textContent = gameState.score;
            finalLevelElement.textContent = gameState.level;
            gameOverElement.classList.add('active');
            
            // æ›´æ–°ç§¯åˆ†æ¦œï¼ˆå¦‚æœå½“å‰åˆ†æ•°æ›´é«˜ï¼‰
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
            }
            
            // ä¿å­˜ç§¯åˆ†æ¦œæ•°æ®
            saveScoreboard();
        }

        // éšè—è¿‡å…³ç•Œé¢
        function hideGameOver() {
            gameOverElement.classList.remove('active');
        }

        // æ˜¾ç¤ºå¤±è´¥ç•Œé¢
        function showGameFail() {
            gameState.isGameOver = true;
            failScoreElement.textContent = gameState.score;
            failLevelElement.textContent = gameState.level;
            gameFailElement.classList.add('active');
            playSound('lose');
            
            // æ›´æ–°ç§¯åˆ†æ¦œï¼ˆå¦‚æœå½“å‰åˆ†æ•°æ›´é«˜ï¼‰
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
            }
            
            // ä¿å­˜ç§¯åˆ†æ¦œæ•°æ®
            saveScoreboard();
        }

        // éšè—å¤±è´¥ç•Œé¢
        function hideGameFail() {
            gameFailElement.classList.remove('active');
        }

        // æ˜¾ç¤ºé€šå…³åŠ¨ç”»
        function showCompletionAnimation() {
            gameState.isGameComplete = true;
            completionScoreElement.textContent = gameState.score;
            
            // æ›´æ–°ç§¯åˆ†æ¦œï¼ˆå¦‚æœå½“å‰åˆ†æ•°æ›´é«˜ï¼‰
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
            }
            
            // ä¿å­˜ç§¯åˆ†æ¦œæ•°æ®
            saveScoreboard();
            
            // åˆ›å»ºå½©è‰²çº¸å±‘æ•ˆæœ
            createConfetti();
            
            completionAnimation.classList.add('active');
            
            // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
            playSound('win');
        }

        // åˆ›å»ºå½©è‰²çº¸å±‘æ•ˆæœ
        function createConfetti() {
            const colors = ['#ffde59', '#ff7b7b', '#6a5acd', '#00ff00', '#00bfff', '#ff69b4'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 15 + 10}px`;
                confetti.style.animationDuration = `${Math.random() * 2 + 2}s`;
                confetti.style.animationDelay = `${Math.random() * 1}s`;
                
                document.body.appendChild(confetti);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤çº¸å±‘
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // éšè—é€šå…³åŠ¨ç”»
        function hideCompletionAnimation() {
            completionAnimation.classList.remove('active');
            
            // ç§»é™¤æ‰€æœ‰çº¸å±‘
            document.querySelectorAll('.confetti').forEach(confetti => {
                confetti.remove();
            });
        }

        // æ˜¾ç¤ºç§¯åˆ†æ¦œ
        function showScoreboard() {
            // æ›´æ–°ç§¯åˆ†æ¦œæ˜¾ç¤º
            highScoreElement.textContent = gameState.highScore;
            
            scoreboardModal.classList.add('active');
        }

        // éšè—ç§¯åˆ†æ¦œ
        function hideScoreboard() {
            scoreboardModal.classList.remove('active');
        }

        // åŠ è½½ç§¯åˆ†æ¦œæ•°æ®
        function loadScoreboard() {
            try {
                const savedHighScore = localStorage.getItem('mahjongHighScore');
                
                if (savedHighScore) {
                    gameState.highScore = parseInt(savedHighScore);
                }
            } catch (e) {
                console.log("æ— æ³•åŠ è½½ç§¯åˆ†æ¦œæ•°æ®");
            }
        }

        // ä¿å­˜ç§¯åˆ†æ¦œæ•°æ®
        function saveScoreboard() {
            try {
                localStorage.setItem('mahjongHighScore', gameState.highScore);
            } catch (e) {
                console.log("æ— æ³•ä¿å­˜ç§¯åˆ†æ¦œæ•°æ®");
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            scoreElement.textContent = gameState.score;
            levelElement.textContent = `${gameState.level}/${config.totalLevels}`;
            updateRemainingCount();
            updateSlotsUsed();
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            // åˆ›å»ºéŸ³æ•ˆä¸Šä¸‹æ–‡
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // æ ¹æ®ç±»å‹åˆ›å»ºä¸åŒçš„éŸ³æ•ˆ
            let frequency = 440;
            let duration = 0.2;
            
            switch(type) {
                case 'select':
                    frequency = 523.25; // C5
                    duration = 0.1;
                    break;
                case 'match':
                    frequency = 659.25; // E5
                    duration = 0.3;
                    break;
                case 'hint':
                    frequency = 783.99; // G5
                    duration = 0.5;
                    break;
                case 'shuffle':
                    // åˆ›å»ºæ´—ç‰ŒéŸ³æ•ˆï¼ˆå¤šä¸ªçŸ­éŸ³ï¼‰
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            const freq = 200 + Math.random() * 300;
                            createTone(audioContext, freq, 0.05);
                        }, i * 50);
                    }
                    return;
                case 'win':
                    // èƒœåˆ©éŸ³æ•ˆï¼ˆä¸Šå‡éŸ³é˜¶ï¼‰
                    const winNotes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                    winNotes.forEach((note, index) => {
                        setTimeout(() => {
                            createTone(audioContext, note, 0.2);
                        }, index * 150);
                    });
                    return;
                case 'lose':
                    // å¤±è´¥éŸ³æ•ˆï¼ˆä¸‹é™éŸ³é˜¶ï¼‰
                    const loseNotes = [523.25, 392.00, 293.66, 196.00]; // C5, G4, D4, G3
                    loseNotes.forEach((note, index) => {
                        setTimeout(() => {
                            createTone(audioContext, note, 0.3);
                        }, index * 200);
                    });
                    return;
            }
            
            createTone(audioContext, frequency, duration);
        }

        // åˆ›å»ºéŸ³è°ƒ
        function createTone(audioContext, frequency, duration) {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                // éŸ³é¢‘ä¸Šä¸‹æ–‡å¯èƒ½ä¸æ”¯æŒï¼Œå¿½ç•¥é”™è¯¯
            }
        }

        // å·¥å…·å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´å¸ƒå±€
        window.addEventListener('resize', () => {
            arrangeTilesRandomly();
            renderTiles();
        });
        
        // æ¨ªå±æ£€æµ‹
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                arrangeTilesRandomly();
                renderTiles();
            }, 100);
        });

        // é˜²æ­¢åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // äº‹ä»¶ç›‘å¬
        hintBtn.addEventListener('click', showHint);
        shuffleBtn.addEventListener('click', shuffleTiles);
        restartBtn.addEventListener('click', () => {
            config.level = 1;
            gameState.score = 0;
            initGame();
        });
        scoreboardBtn.addEventListener('click', showScoreboard);
        nextLevelBtn.addEventListener('click', nextLevel);
        gameOverRestartBtn.addEventListener('click', () => {
            config.level = 1;
            gameState.score = 0;
            initGame();
        });
        failRestartBtn.addEventListener('click', () => {
            config.level = 1;
            gameState.score = 0;
            initGame();
        });
        closeScoreboardBtn.addEventListener('click', hideScoreboard);
        completionRestartBtn.addEventListener('click', () => {
            hideCompletionAnimation();
            config.level = 1;
            gameState.score = 0;
            initGame();
        });

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>
